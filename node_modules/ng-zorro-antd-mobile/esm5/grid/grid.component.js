import { __decorate, __metadata } from "tslib";
import { Component, Input, Output, EventEmitter, TemplateRef, HostBinding } from '@angular/core';
var GridComponent = /** @class */ (function () {
    function GridComponent() {
        this.wrapCls = {};
        this.itemCls = {};
        this.carouselProps = {
            dots: false,
            dragging: false
        };
        this.defaultProps = {
            data: [],
            hasLine: true,
            isCarousel: false,
            columnNum: 4,
            carouselMaxRow: 2,
            prefixCls: 'am-grid',
            square: true,
            itemStyle: {}
        };
        this.carouselData = [];
        this.carouselDataTmp = [];
        this.gridData = [];
        this._data = [];
        this.itemStyle = {};
        this.square = true;
        this.hasLine = true;
        this.activeStyle = true;
        this.onClick = new EventEmitter();
        this.amGrid = true;
    }
    Object.defineProperty(GridComponent.prototype, "columnNum", {
        get: function () {
            return this.defaultProps.columnNum;
        },
        set: function (value) {
            if (typeof value === 'number') {
                this.defaultProps.columnNum = value;
                this.init();
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(GridComponent.prototype, "carouselMaxRow", {
        get: function () {
            return this.defaultProps.carouselMaxRow;
        },
        set: function (value) {
            if (typeof value === 'number') {
                this.defaultProps.carouselMaxRow = value;
                this.init();
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(GridComponent.prototype, "isCarousel", {
        get: function () {
            return this.defaultProps.isCarousel;
        },
        set: function (value) {
            this.defaultProps.isCarousel = value;
            this.init();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(GridComponent.prototype, "data", {
        set: function (value) {
            this._data = value;
            this.init();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(GridComponent.prototype, "amGridSquare", {
        get: function () {
            return true === this.square;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(GridComponent.prototype, "amGridLine", {
        get: function () {
            return true === this.hasLine;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(GridComponent.prototype, "amGridCarousel", {
        get: function () {
            return true === this.isCarousel;
        },
        enumerable: true,
        configurable: true
    });
    GridComponent.prototype.getContentType = function (value) {
        if ((value.indexOf('http') >= 0 || value.indexOf('assets') >= 0) && value.indexOf('<') < 0) {
            return 'url';
        }
        else if (value.indexOf('<') >= 0) {
            return 'innerHTML';
        }
        else if (value instanceof TemplateRef) {
            return 'TemplateRef';
        }
        else {
            return 'icon';
        }
    };
    GridComponent.prototype.init = function () {
        var dataLength = (this._data && this._data.length) || 0;
        var rowCount = Math.ceil(dataLength / this.columnNum);
        var rowsArr;
        if (this.defaultProps.isCarousel) {
            if (rowCount % this.carouselMaxRow !== 0) {
                rowCount = rowCount + this.carouselMaxRow - (rowCount % this.carouselMaxRow);
            }
            var pageCount = Math.ceil(rowCount / this.carouselMaxRow);
            rowsArr = this.getRows(rowCount, dataLength);
            if (pageCount <= 1) {
                this.carouselProps = {
                    dots: false,
                    dragging: false
                };
            }
            else {
                this.carouselProps = {
                    dots: true,
                    dragging: true
                };
            }
            this.carouselDataTmp = this.getCarouselData(rowsArr, pageCount, rowCount);
        }
        else {
            this.gridData = this.getRows(rowCount, dataLength);
        }
    };
    GridComponent.prototype.getCarouselData = function (rowsArr, pageCount, rowCount) {
        var pagesArr = [];
        for (var pageIndex = 0; pageIndex < pageCount; pageIndex++) {
            var pageRows = [];
            for (var ii = 0; ii < this.carouselMaxRow; ii++) {
                var rowIndex = pageIndex * this.carouselMaxRow + ii;
                if (rowIndex < rowCount) {
                    pageRows.push(rowsArr[rowIndex]);
                }
                else {
                    // 空节点为了确保末尾页的最后未到底的行有底线(样式中last-child会没线)
                    pageRows.push(null);
                }
            }
            pagesArr.push(pageRows);
        }
        return pagesArr;
    };
    GridComponent.prototype.getRows = function (rowCount, dataLength) {
        var columnNum = this.columnNum;
        var rowArr = new Array();
        for (var i = 0; i < rowCount; i++) {
            rowArr[i] = new Array();
            for (var j = 0; j < columnNum; j++) {
                var dataIndex = i * columnNum + j;
                if (dataIndex < dataLength) {
                    rowArr[i][j] = this._data[dataIndex];
                }
                else {
                    rowArr[i][j] = null;
                }
            }
        }
        return rowArr;
    };
    GridComponent.prototype.click = function (data, index) {
        var outputData = {
            data: data,
            index: index
        };
        this.onClick.emit(outputData);
    };
    GridComponent.prototype.ngOnInit = function () {
        var _a;
        this.itemCls = (_a = {},
            _a[this.defaultProps.prefixCls + "-item"] = true,
            _a[this.defaultProps.prefixCls + "-active-item"] = false,
            _a);
    };
    __decorate([
        Input(),
        __metadata("design:type", Number),
        __metadata("design:paramtypes", [Number])
    ], GridComponent.prototype, "columnNum", null);
    __decorate([
        Input(),
        __metadata("design:type", Number),
        __metadata("design:paramtypes", [Number])
    ], GridComponent.prototype, "carouselMaxRow", null);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], GridComponent.prototype, "itemStyle", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Boolean)
    ], GridComponent.prototype, "square", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Boolean)
    ], GridComponent.prototype, "hasLine", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Boolean),
        __metadata("design:paramtypes", [Boolean])
    ], GridComponent.prototype, "isCarousel", null);
    __decorate([
        Input(),
        __metadata("design:type", Boolean)
    ], GridComponent.prototype, "activeStyle", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Array),
        __metadata("design:paramtypes", [Array])
    ], GridComponent.prototype, "data", null);
    __decorate([
        Output(),
        __metadata("design:type", EventEmitter)
    ], GridComponent.prototype, "onClick", void 0);
    __decorate([
        HostBinding('class.am-grid'),
        __metadata("design:type", Boolean)
    ], GridComponent.prototype, "amGrid", void 0);
    __decorate([
        HostBinding('class.am-grid-square'),
        __metadata("design:type", Boolean),
        __metadata("design:paramtypes", [])
    ], GridComponent.prototype, "amGridSquare", null);
    __decorate([
        HostBinding('class.am-grid-line'),
        __metadata("design:type", Boolean),
        __metadata("design:paramtypes", [])
    ], GridComponent.prototype, "amGridLine", null);
    __decorate([
        HostBinding('class.am-grid-carousel'),
        __metadata("design:type", Boolean),
        __metadata("design:paramtypes", [])
    ], GridComponent.prototype, "amGridCarousel", null);
    GridComponent = __decorate([
        Component({
            selector: 'Grid, nzm-grid',
            template: "<ng-container *ngIf=\"!isCarousel\">\n  <Flex *ngFor=\"let item of gridData; let i = index\" [justify]=\"'center'\" [align]=\"'stretch'\">\n    <FlexItem\n      TouchFeedbackDirective\n      *ngFor=\"let subItem of item; let j = index\"\n      [ngClass]=\"itemCls\"\n      [ngStyle]=\"itemStyle\"\n      [className]=\"['am-grid-item-active']\"\n      [activeStyle]=\"activeStyle\"\n    >\n      <div\n        *ngIf=\"subItem !== null\"\n        class=\"{{ defaultProps.prefixCls }}-item-content\"\n        (click)=\"click(subItem, i * columnNum + j)\"\n      >\n        <div class=\"{{ defaultProps.prefixCls }}-item-inner-content column-num-{{ columnNum }}\">\n          <img\n            *ngIf=\"subItem.icon && getContentType(subItem.icon) === 'url'\"\n            src=\"{{ subItem.icon }}\"\n            class=\"{{ defaultProps.prefixCls }}-icon\"\n          />\n          <Icon\n            *ngIf=\"subItem.icon && getContentType(subItem.icon) === 'icon'\"\n            [type]=\"subItem.icon\"\n            [size]=\"subItem.size\"\n          ></Icon>\n          <div\n            *ngIf=\"subItem.icon && getContentType(subItem.icon) === 'innerHTML'\"\n            [innerHTML]=\"subItem.icon | safeHTML\"\n          ></div>\n          <ng-template\n            *ngIf=\"subItem.icon && getContentType(subItem.icon) === 'TemplateRef'\"\n            [ngTemplateOutlet]=\"subItem.icon\"\n          ></ng-template>\n          <div class=\"{{ defaultProps.prefixCls }}-text\">{{ subItem.text }}</div>\n        </div>\n      </div>\n      <div *ngIf=\"subItem === null\" class=\"{{ defaultProps.prefixCls }}-null-item\"></div>\n    </FlexItem>\n  </Flex>\n  <ng-content></ng-content>\n</ng-container>\n\n<Carousel\n  *ngIf=\"isCarousel && carouselDataTmp.length > 0\"\n  [autoplay]=\"false\"\n  [infinite]=\"true\"\n  [selectedIndex]=\"0\"\n  [autoplayInterval]=\"3000\"\n  [dots]=\"carouselProps.dots\"\n  [dragging]=\"carouselProps.dragging\"\n>\n  <CarouselSlide\n    *ngFor=\"let gridData of carouselDataTmp\"\n    class=\"{{ defaultProps.prefixCls }}-carousel-page\"\n    style=\"display: block;\"\n  >\n    <Flex *ngFor=\"let item of gridData; let i = index\" [justify]=\"'center'\" [align]=\"'stretch'\">\n      <FlexItem\n        TouchFeedbackDirective\n        *ngFor=\"let subItem of item; let j = index\"\n        class=\"{{ defaultProps.prefixCls }}-item\"\n        [ngStyle]=\"itemStyle\"\n        [className]=\"['am-grid-item-active']\"\n      >\n        <div\n          *ngIf=\"subItem !== null\"\n          class=\"{{ defaultProps.prefixCls }}-item-content\"\n          (click)=\"click(subItem, i * columnNum + j)\"\n        >\n          <div class=\"{{ defaultProps.prefixCls }}-item-inner-content column-num-4\">\n            <img class=\"{{ defaultProps.prefixCls }}-icon\" src=\"{{ subItem.icon }}\" />\n            <div class=\"{{ defaultProps.prefixCls }}-text\">{{ subItem.text }}</div>\n          </div>\n        </div>\n        <div *ngIf=\"subItem === null\" class=\"{{ defaultProps.prefixCls }}-null-item\"></div>\n      </FlexItem>\n    </Flex>\n  </CarouselSlide>\n</Carousel>\n"
        }),
        __metadata("design:paramtypes", [])
    ], GridComponent);
    return GridComponent;
}());
export { GridComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JpZC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZy16b3Jyby1hbnRkLW1vYmlsZS8iLCJzb3VyY2VzIjpbImdyaWQvZ3JpZC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsV0FBVyxFQUFFLFdBQVcsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQU16RztJQWtGRTtRQWpGQSxZQUFPLEdBQUcsRUFBRSxDQUFDO1FBQ2IsWUFBTyxHQUFHLEVBQUUsQ0FBQztRQUNiLGtCQUFhLEdBQUc7WUFDZCxJQUFJLEVBQUUsS0FBSztZQUNYLFFBQVEsRUFBRSxLQUFLO1NBQ2hCLENBQUM7UUFDRixpQkFBWSxHQUFHO1lBQ2IsSUFBSSxFQUFFLEVBQUU7WUFDUixPQUFPLEVBQUUsSUFBSTtZQUNiLFVBQVUsRUFBRSxLQUFLO1lBQ2pCLFNBQVMsRUFBRSxDQUFDO1lBQ1osY0FBYyxFQUFFLENBQUM7WUFDakIsU0FBUyxFQUFFLFNBQVM7WUFDcEIsTUFBTSxFQUFFLElBQUk7WUFDWixTQUFTLEVBQUUsRUFBRTtTQUNkLENBQUM7UUFDRixpQkFBWSxHQUFHLEVBQUUsQ0FBQztRQUNsQixvQkFBZSxHQUFHLEVBQUUsQ0FBQztRQUNyQixhQUFRLEdBQUcsRUFBRSxDQUFDO1FBRU4sVUFBSyxHQUFHLEVBQUUsQ0FBQztRQXVCbkIsY0FBUyxHQUFXLEVBQUUsQ0FBQztRQUV2QixXQUFNLEdBQVksSUFBSSxDQUFDO1FBRXZCLFlBQU8sR0FBWSxJQUFJLENBQUM7UUFVeEIsZ0JBQVcsR0FBWSxJQUFJLENBQUM7UUFPNUIsWUFBTyxHQUFzQixJQUFJLFlBQVksRUFBRSxDQUFDO1FBR2hELFdBQU0sR0FBWSxJQUFJLENBQUM7SUFjUixDQUFDO0lBMURoQixzQkFBSSxvQ0FBUzthQUFiO1lBQ0UsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQztR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Q1YsR0FBSSxJQUFJLENBQUMsWUFBWSxDQUFDLFNBQVMsVUFBTyxJQUFHLElBQUk7WUFDN0MsR0FBSSxJQUFJLENBQUMsWUFBWSxDQUFDLFNBQVMsaUJBQWMsSUFBRyxLQUFLO2VBQ3RELENBQUM7SUFDSixDQUFDO0lBbkpEO1FBREMsS0FBSyxFQUFFOzs7a0RBR1A7SUFRRDtRQURDLEtBQUssRUFBRTs7O3VEQUdQO0lBUUQ7UUFEQyxLQUFLLEVBQUU7O29EQUNlO0lBRXZCO1FBREMsS0FBSyxFQUFFOztpREFDZTtJQUV2QjtRQURDLEtBQUssRUFBRTs7a0RBQ2dCO0lBRXhCO1FBREMsS0FBSyxFQUFFOzs7bURBR1A7SUFNRDtRQURDLEtBQUssRUFBRTs7c0RBQ29CO0lBRTVCO1FBREMsS0FBSyxFQUFFO2tDQUNRLEtBQUs7eUNBQUwsS0FBSzs2Q0FHcEI7SUFFRDtRQURDLE1BQU0sRUFBRTtrQ0FDQSxZQUFZO2tEQUEyQjtJQUdoRDtRQURDLFdBQVcsQ0FBQyxlQUFlLENBQUM7O2lEQUNOO0lBRXZCO1FBREMsV0FBVyxDQUFDLHNCQUFzQixDQUFDOzs7cURBR25DO0lBRUQ7UUFEQyxXQUFXLENBQUMsb0JBQW9CLENBQUM7OzttREFHakM7SUFFRDtRQURDLFdBQVcsQ0FBQyx3QkFBd0IsQ0FBQzs7O3VEQUdyQztJQWhGVSxhQUFhO1FBSnpCLFNBQVMsQ0FBQztZQUNULFFBQVEsRUFBRSxnQkFBZ0I7WUFDMUIsNGlHQUFvQztTQUNyQyxDQUFDOztPQUNXLGFBQWEsQ0E0S3pCO0lBQUQsb0JBQUM7Q0FBQSxBQTVLRCxJQTRLQztTQTVLWSxhQUFhIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgVGVtcGxhdGVSZWYsIEhvc3RCaW5kaW5nIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ0dyaWQsIG56bS1ncmlkJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2dyaWQuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIEdyaWRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICB3cmFwQ2xzID0ge307XG4gIGl0ZW1DbHMgPSB7fTtcbiAgY2Fyb3VzZWxQcm9wcyA9IHtcbiAgICBkb3RzOiBmYWxzZSxcbiAgICBkcmFnZ2luZzogZmFsc2VcbiAgfTtcbiAgZGVmYXVsdFByb3BzID0ge1xuICAgIGRhdGE6IFtdLFxuICAgIGhhc0xpbmU6IHRydWUsXG4gICAgaXNDYXJvdXNlbDogZmFsc2UsXG4gICAgY29sdW1uTnVtOiA0LFxuICAgIGNhcm91c2VsTWF4Um93OiAyLFxuICAgIHByZWZpeENsczogJ2FtLWdyaWQnLFxuICAgIHNxdWFyZTogdHJ1ZSxcbiAgICBpdGVtU3R5bGU6IHt9XG4gIH07XG4gIGNhcm91c2VsRGF0YSA9IFtdO1xuICBjYXJvdXNlbERhdGFUbXAgPSBbXTtcbiAgZ3JpZERhdGEgPSBbXTtcblxuICBwcml2YXRlIF9kYXRhID0gW107XG5cbiAgQElucHV0KClcbiAgZ2V0IGNvbHVtbk51bSgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmRlZmF1bHRQcm9wcy5jb2x1bW5OdW07XG4gIH1cbiAgc2V0IGNvbHVtbk51bSh2YWx1ZTogbnVtYmVyKSB7XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicpIHtcbiAgICAgIHRoaXMuZGVmYXVsdFByb3BzLmNvbHVtbk51bSA9IHZhbHVlO1xuICAgICAgdGhpcy5pbml0KCk7XG4gICAgfVxuICB9XG4gIEBJbnB1dCgpXG4gIGdldCBjYXJvdXNlbE1heFJvdygpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmRlZmF1bHRQcm9wcy5jYXJvdXNlbE1heFJvdztcbiAgfVxuICBzZXQgY2Fyb3VzZWxNYXhSb3codmFsdWU6IG51bWJlcikge1xuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInKSB7XG4gICAgICB0aGlzLmRlZmF1bHRQcm9wcy5jYXJvdXNlbE1heFJvdyA9IHZhbHVlO1xuICAgICAgdGhpcy5pbml0KCk7XG4gICAgfVxuICB9XG4gIEBJbnB1dCgpXG4gIGl0ZW1TdHlsZTogb2JqZWN0ID0ge307XG4gIEBJbnB1dCgpXG4gIHNxdWFyZTogYm9vbGVhbiA9IHRydWU7XG4gIEBJbnB1dCgpXG4gIGhhc0xpbmU6IGJvb2xlYW4gPSB0cnVlO1xuICBASW5wdXQoKVxuICBnZXQgaXNDYXJvdXNlbCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5kZWZhdWx0UHJvcHMuaXNDYXJvdXNlbDtcbiAgfVxuICBzZXQgaXNDYXJvdXNlbCh2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMuZGVmYXVsdFByb3BzLmlzQ2Fyb3VzZWwgPSB2YWx1ZTtcbiAgICB0aGlzLmluaXQoKTtcbiAgfVxuICBASW5wdXQoKVxuICBhY3RpdmVTdHlsZTogYm9vbGVhbiA9IHRydWU7XG4gIEBJbnB1dCgpXG4gIHNldCBkYXRhKHZhbHVlOiBBcnJheTxhbnk+KSB7XG4gICAgdGhpcy5fZGF0YSA9IHZhbHVlO1xuICAgIHRoaXMuaW5pdCgpO1xuICB9XG4gIEBPdXRwdXQoKVxuICBvbkNsaWNrOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICBASG9zdEJpbmRpbmcoJ2NsYXNzLmFtLWdyaWQnKVxuICBhbUdyaWQ6IGJvb2xlYW4gPSB0cnVlO1xuICBASG9zdEJpbmRpbmcoJ2NsYXNzLmFtLWdyaWQtc3F1YXJlJylcbiAgZ2V0IGFtR3JpZFNxdWFyZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdHJ1ZSA9PT0gdGhpcy5zcXVhcmU7XG4gIH1cbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5hbS1ncmlkLWxpbmUnKVxuICBnZXQgYW1HcmlkTGluZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdHJ1ZSA9PT0gdGhpcy5oYXNMaW5lO1xuICB9XG4gIEBIb3N0QmluZGluZygnY2xhc3MuYW0tZ3JpZC1jYXJvdXNlbCcpXG4gIGdldCBhbUdyaWRDYXJvdXNlbCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdHJ1ZSA9PT0gdGhpcy5pc0Nhcm91c2VsO1xuICB9XG5cbiAgY29uc3RydWN0b3IoKSB7fVxuXG4gIGdldENvbnRlbnRUeXBlKHZhbHVlOiBhbnkpOiBzdHJpbmcge1xuICAgIGlmICgodmFsdWUuaW5kZXhPZignaHR0cCcpID49IDAgfHwgdmFsdWUuaW5kZXhPZignYXNzZXRzJykgPj0gMCkgJiYgdmFsdWUuaW5kZXhPZignPCcpIDwgMCkge1xuICAgICAgcmV0dXJuICd1cmwnO1xuICAgIH0gZWxzZSBpZiAodmFsdWUuaW5kZXhPZignPCcpID49IDApIHtcbiAgICAgIHJldHVybiAnaW5uZXJIVE1MJztcbiAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgVGVtcGxhdGVSZWYpIHtcbiAgICAgIHJldHVybiAnVGVtcGxhdGVSZWYnO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gJ2ljb24nO1xuICAgIH1cbiAgfVxuXG4gIGluaXQoKSB7XG4gICAgY29uc3QgZGF0YUxlbmd0aCA9ICh0aGlzLl9kYXRhICYmIHRoaXMuX2RhdGEubGVuZ3RoKSB8fCAwO1xuICAgIGxldCByb3dDb3VudCA9IE1hdGguY2VpbChkYXRhTGVuZ3RoIC8gdGhpcy5jb2x1bW5OdW0pO1xuICAgIGxldCByb3dzQXJyO1xuICAgIGlmICh0aGlzLmRlZmF1bHRQcm9wcy5pc0Nhcm91c2VsKSB7XG4gICAgICBpZiAocm93Q291bnQgJSB0aGlzLmNhcm91c2VsTWF4Um93ICE9PSAwKSB7XG4gICAgICAgIHJvd0NvdW50ID0gcm93Q291bnQgKyB0aGlzLmNhcm91c2VsTWF4Um93IC0gKHJvd0NvdW50ICUgdGhpcy5jYXJvdXNlbE1heFJvdyk7XG4gICAgICB9XG4gICAgICBjb25zdCBwYWdlQ291bnQgPSBNYXRoLmNlaWwocm93Q291bnQgLyB0aGlzLmNhcm91c2VsTWF4Um93KTtcbiAgICAgIHJvd3NBcnIgPSB0aGlzLmdldFJvd3Mocm93Q291bnQsIGRhdGFMZW5ndGgpO1xuICAgICAgaWYgKHBhZ2VDb3VudCA8PSAxKSB7XG4gICAgICAgIHRoaXMuY2Fyb3VzZWxQcm9wcyA9IHtcbiAgICAgICAgICBkb3RzOiBmYWxzZSxcbiAgICAgICAgICBkcmFnZ2luZzogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuY2Fyb3VzZWxQcm9wcyA9IHtcbiAgICAgICAgICBkb3RzOiB0cnVlLFxuICAgICAgICAgIGRyYWdnaW5nOiB0cnVlXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICB0aGlzLmNhcm91c2VsRGF0YVRtcCA9IHRoaXMuZ2V0Q2Fyb3VzZWxEYXRhKHJvd3NBcnIsIHBhZ2VDb3VudCwgcm93Q291bnQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmdyaWREYXRhID0gdGhpcy5nZXRSb3dzKHJvd0NvdW50LCBkYXRhTGVuZ3RoKTtcbiAgICB9XG4gIH1cblxuICBnZXRDYXJvdXNlbERhdGEocm93c0FycjogYW55W10sIHBhZ2VDb3VudDogbnVtYmVyLCByb3dDb3VudDogbnVtYmVyKSB7XG4gICAgY29uc3QgcGFnZXNBcnI6IGFueVtdID0gW107XG4gICAgZm9yIChsZXQgcGFnZUluZGV4ID0gMDsgcGFnZUluZGV4IDwgcGFnZUNvdW50OyBwYWdlSW5kZXgrKykge1xuICAgICAgY29uc3QgcGFnZVJvd3M6IGFueVtdID0gW107XG4gICAgICBmb3IgKGxldCBpaSA9IDA7IGlpIDwgdGhpcy5jYXJvdXNlbE1heFJvdzsgaWkrKykge1xuICAgICAgICBjb25zdCByb3dJbmRleCA9IHBhZ2VJbmRleCAqIHRoaXMuY2Fyb3VzZWxNYXhSb3cgKyBpaTtcbiAgICAgICAgaWYgKHJvd0luZGV4IDwgcm93Q291bnQpIHtcbiAgICAgICAgICBwYWdlUm93cy5wdXNoKHJvd3NBcnJbcm93SW5kZXhdKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyDnqbroioLngrnkuLrkuobnoa7kv53mnKvlsL7pobXnmoTmnIDlkI7mnKrliLDlupXnmoTooYzmnInlupXnur8o5qC35byP5LitbGFzdC1jaGlsZOS8muayoee6vylcbiAgICAgICAgICBwYWdlUm93cy5wdXNoKG51bGwpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBwYWdlc0Fyci5wdXNoKHBhZ2VSb3dzKTtcbiAgICB9XG4gICAgcmV0dXJuIHBhZ2VzQXJyO1xuICB9XG5cbiAgZ2V0Um93cyhyb3dDb3VudDogbnVtYmVyLCBkYXRhTGVuZ3RoOiBudW1iZXIpIHtcbiAgICBjb25zdCBjb2x1bW5OdW0gPSB0aGlzLmNvbHVtbk51bTtcbiAgICBjb25zdCByb3dBcnIgPSBuZXcgQXJyYXkoKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJvd0NvdW50OyBpKyspIHtcbiAgICAgIHJvd0FycltpXSA9IG5ldyBBcnJheSgpO1xuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBjb2x1bW5OdW07IGorKykge1xuICAgICAgICBjb25zdCBkYXRhSW5kZXggPSBpICogY29sdW1uTnVtICsgajtcbiAgICAgICAgaWYgKGRhdGFJbmRleCA8IGRhdGFMZW5ndGgpIHtcbiAgICAgICAgICByb3dBcnJbaV1bal0gPSB0aGlzLl9kYXRhW2RhdGFJbmRleF07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcm93QXJyW2ldW2pdID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcm93QXJyO1xuICB9XG5cbiAgY2xpY2soZGF0YSwgaW5kZXgpIHtcbiAgICBjb25zdCBvdXRwdXREYXRhID0ge1xuICAgICAgZGF0YTogZGF0YSxcbiAgICAgIGluZGV4OiBpbmRleFxuICAgIH07XG4gICAgdGhpcy5vbkNsaWNrLmVtaXQob3V0cHV0RGF0YSk7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLml0ZW1DbHMgPSB7XG4gICAgICBbYCR7dGhpcy5kZWZhdWx0UHJvcHMucHJlZml4Q2xzfS1pdGVtYF06IHRydWUsXG4gICAgICBbYCR7dGhpcy5kZWZhdWx0UHJvcHMucHJlZml4Q2xzfS1hY3RpdmUtaXRlbWBdOiBmYWxzZVxuICAgIH07XG4gIH1cbn1cbiJdfQ==